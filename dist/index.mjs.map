{"version":3,"file":"index.mjs","sources":["../src/index.js"],"sourcesContent":["\n    \"use strict\";\n\n    // FIXME: remove console usage for IE compatibility\n\n    export default function(elem, conf) {\n\n        // It faster to access a property than to access a variable...\n        // See https://jsperf.com/vars-vs-props-speed-comparison/1\n\n        const NS = \"http://www.w3.org/2000/svg\";\n\n        let svg_element = elem;    // DOM element\n\n        if (typeof elem === \"string\" || elem instanceof String) {\n            elem = document.querySelector(elem);\n        }\n\n        if (elem.nodeName.toLowerCase() === \"svg\") {\n            svg_element = elem;\n        } else {\n            svg_element = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n            elem.appendChild(svg_element);\n        }\n\n        // For the user convenience, the label can be set with the \"data-label\" attribute.\n        // If another label is set in data-config then this later definition will override data-label.\n        let label = elem.dataset.label !== undefined ? elem.dataset.label : false;\n\n        let defaults = {\n\n            // User configurable properties.\n            // No camelCase because we want to be able to have the same name in data- attributes.\n\n            label: false,\n            env_color: \"blue\",\n            env_width: 4,\n            with_label: true,\n            width_A: 0.25,\n            width_D: 0.25,\n            width_R: 0.25,\n            env: {          // default envelope; structure compatible with BS2.getADSREnv()\n                attack: 1,\n                decay: 1,\n                sustain: 0.5,\n                release: 1\n            }\n        };\n\n        //---------------------------------------------------------------------\n        // Merge user config with default config:\n        let data_config = JSON.parse(svg_element.dataset.config || \"{}\");\n        let config = Object.assign({}, defaults, conf, data_config);\n\n        //---------------------------------------------------------------------\n        // Create the envelope:\n        let env = config.env;\n        draw();\n\n        /**\n         *\n         * @param e\n         */\n        function setEnvelope(e) {\n            env = e;\n        }\n\n        /**\n         * viewBox is (0 0 100 100)\n         *\n         * env is {attack:0..1, decay:0..1, sustain:0..1, release: 0..1}\n         */\n        function getPath() {\n\n            let p = \"\";\n\n            const hw = (config.env_width / 2);\n\n            // start position\n            let x = 0.0;\n            let y = 0.0;\n            p += `M${x * 100.0 + hw},${100.0 - y}`; // start at lower left corner\n\n            // Attack\n            x += env.attack * config.width_A;\n            y = 100.0 - hw;\n            p += `L${x * 100.0},${100.0 - y}`;\n\n            // Decay\n            x += env.decay * config.width_D;\n            y = env.sustain * 100.0 - hw;\n            p += `L${x * 100.0},${100.0 - y + 2}`;\n\n            // Sustain\n            x = 1.0 - (env.release * config.width_R);\n            y = env.sustain * 100.0 - hw;\n            p += `L${x * 100.0},${100.0 - y + 2}`;\n\n            // Release\n            x = 1.0;\n            y = config.env_width / 2;\n            p += `L${x * 100.0 - hw},${100.0 - y + 2}`;\n\n            return p;\n        }\n\n        /**\n         *\n         */\n        function draw() {\n\n            // For the use of null argument with setAttributeNS, see https://developer.mozilla.org/en-US/docs/Web/SVG/Namespaces_Crash_Course#Scripting_in_namespaced_XML\n\n            // https://www.w3.org/TR/SVG/render.html#RenderingOrder:\n            // Elements in an SVG document fragment have an implicit drawing order, with the first elements in the SVG document\n            // fragment getting \"painted\" first. Subsequent elements are painted on top of previously painted elements.\n            // ==> first element -> \"painted\" first\n\n            svg_element.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\n            svg_element.setAttributeNS(null, \"viewBox\", \"0 0 100 100\");\n            svg_element.setAttributeNS(null, \"preserveAspectRatio\", \"none\");\n            svg_element.setAttribute(\"class\", \"envelope\");\n\n            let path = document.createElementNS(NS, \"path\");\n            path.setAttributeNS(null, \"d\", getPath(env));\n            path.setAttribute(\"vector-effect\", \"non-scaling-stroke\");\n            path.setAttribute(\"stroke\", config.env_color);\n            path.setAttribute(\"stroke-width\", \"\" + config.env_width);\n            path.setAttribute(\"fill\", \"transparent\");\n            path.setAttribute(\"class\", \"envelope-path\");\n            svg_element.appendChild(path);\n\n        }  // draw()\n\n        /**\n         *\n         */\n        function redraw() {\n            svg_element.childNodes[0].setAttributeNS(null, \"d\", getPath());\n        }\n\n        /**\n         *\n         */\n        return {\n            set envelope(e) {\n                setEnvelope(e);\n                redraw();\n            }\n        };\n\n    }\n"],"names":["elem","conf","svg_element","String","document","querySelector","nodeName","toLowerCase","createElementNS","appendChild","data_config","JSON","parse","dataset","config","Object","assign","label","env_color","env_width","with_label","width_A","width_D","width_R","env","attack","decay","sustain","release","getPath","p","hw","x","y","setAttributeNS","setAttribute","path","draw","e","setEnvelope","childNodes"],"mappings":"eAKmB,SAASA,EAAMC,OAOtBC,EAAcF,GAEE,iBAATA,GAAqBA,aAAgBG,UAC5CH,EAAOI,SAASC,cAAcL,IAGE,QAAhCA,EAAKM,SAASC,cACdL,EAAcF,GAEdE,EAAcE,SAASI,gBAAgB,6BAA8B,OACrER,EAAKS,YAAYP,QA6BjBQ,EAAcC,KAAKC,MAAMV,EAAYW,QAAQC,QAAU,MACvDA,EAASC,OAAOC,OAAO,GAvBZ,CAKXC,OAAO,EACPC,UAAW,OACXC,UAAW,EACXC,YAAY,EACZC,QAAS,IACTC,QAAS,IACTC,QAAS,IACTC,IAAK,CACDC,OAAQ,EACRC,MAAO,EACPC,QAAS,GACTC,QAAS,IAOwB3B,EAAMS,GAI3Cc,EAAMV,EAAOU,aAgBRK,QAEDC,EAAI,GAEFC,EAAMjB,EAAOK,UAAY,EAG3Ba,EAAI,EACJC,EAAI,SACRH,GAAM,KAAO,IAAJE,EAAYD,QAAM,IAAQE,GAKnCH,GAAM,IAAO,KAFbE,GAAKR,EAAIC,OAASX,EAAOO,cAEH,KADtBY,EAAI,IAAQF,IAMZD,GAAM,IAAO,KAFbE,GAAKR,EAAIE,MAAQZ,EAAOQ,cAEF,KADtBW,EAAkB,IAAdT,EAAIG,QAAkBI,GACQ,IAKlCD,GAAM,IAAO,KAFbE,EAAI,EAAOR,EAAII,QAAUd,EAAOS,cAEV,KADtBU,EAAkB,IAAdT,EAAIG,QAAkBI,GACQ,IAK5B,KAAO,KAFbC,EAAI,GAEiBD,QAAM,KAD3BE,EAAInB,EAAOK,UAAY,GACgB,qBAiBvCjB,EAAYgC,eAAe,gCAAiC,cAAe,gCAC3EhC,EAAYgC,eAAe,KAAM,UAAW,eAC5ChC,EAAYgC,eAAe,KAAM,sBAAuB,QACxDhC,EAAYiC,aAAa,QAAS,gBAE9BC,EAAOhC,SAASI,gBAjHb,6BAiHiC,QACxC4B,EAAKF,eAAe,KAAM,IAAKL,KAC/BO,EAAKD,aAAa,gBAAiB,sBACnCC,EAAKD,aAAa,SAAUrB,EAAOI,WACnCkB,EAAKD,aAAa,eAAgB,GAAKrB,EAAOK,WAC9CiB,EAAKD,aAAa,OAAQ,eAC1BC,EAAKD,aAAa,QAAS,iBAC3BjC,EAAYO,YAAY2B,GAzE5BC,GAuFO,cACUC,aAlFIA,GACjBd,EAAMc,EAkFFC,CAAYD,GARhBpC,EAAYsC,WAAW,GAAGN,eAAe,KAAM,IAAKL"}